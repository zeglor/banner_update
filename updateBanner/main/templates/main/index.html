{% load staticfiles %}

<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="{% static 'main/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- jQuery -->
    <script src="{% static 'main/js/jquery-2.1.4.min.js' %}"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script>
		var cServer = 'http://127.0.0.1:8000/';
		var csrftoken = "";
		
		function getCookie(name){
			var cookieValue = null;
			if (document.cookie && document.cookie != ''){
				var cookies = document.cookie.split(';');
				for (var i=0; i<cookies.length; i++){
					var cookie = jQuery.trim(cookies[i]);
					if (cookie.substring(0, name.length + 1) == (name + '=')){
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		
		function requestBannerUpdate(){
			//get csrf
			csrftoken = getCookie("csrftoken");
			
			$.ajax({
				url: cServer + "request_update/",
				type: "POST",
				contentType: "application/json",
				dataType: "json",
				error: function(error){
					console.log(error);
				},
				success: function(data){
					console.log(data);
				},
			});
		}
		
		function updateProgressBar(current, total){
			
		}
		
		// Polls server for task status
		function statusPoll(){
			var pollInterval = 500;
			
			$.ajax({
				url: cServer + "status/",
				type: "GET",
				contentType: "application/json",
				dataType: "json",
				error: function(error){
					console.log(error);
					pollInterval = 5000;
				},
				success: function(data){
					updateProgressBar(data["current"], data["total"]);
					pollInterval = 500;
				},
				complete: function(){
					setTimeout(statusPoll, pollInterval);
				}
			});
		}
		
		$(function(){
			function csrfSafeMethod(method){
				// these HTTP methods dont require csrf protection
				return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			}
			
			$.ajaxSetup({
				beforeSend: function(xhr, settings){
					if (!csrfSafeMethod(settings.type) && !this.crossDomain){
						xhr.setRequestHeader("X-CSRFToken", csrftoken);
					}
				}
			});
			
			// add onClick event to button
			$("#updateButton").click(function(){
				requestBannerUpdate();
			});
		});
    </script>
    
  </head>
<body>
	<div class="container-fluid">
	hello
		<div class="row">
			<div class="col-md-6">
				<ul>
					<li>1</li>
					<li>2</li>
					<li>3</li>
				</ul>
			</div>
			<div class="col-md-2">
				<button class="btn btn-default" id="updateButton">Обновить</button>
			</div>
			<div class="col-md-4">
				<div class="progress">
					<div id="task_progress_bar" class="progress-bar progress-bar-striped" role="progressbar" 
					aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%;">
						<span>500 of 600</span>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12" id="status_text">
			</div>
		</div>
	</div>
</body>
</html>
